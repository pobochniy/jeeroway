name: List Api Versions

on:
  workflow_dispatch:

jobs:
  list-versions:
    runs-on: [self-hosted, jeeroway-vm]
    steps:
      - name: List available Docker images
        run: |
          echo "ğŸ“¦ Available jeeroway-api versions:"
          echo "=================================="
          docker images jeeroway-api --format "table {{.Tag}}\t{{.CreatedAt}}\t{{.Size}}" | head -20
          
          echo ""
          echo "ğŸƒ Currently running container:"
          echo "=================================="
          if docker ps | grep -q "japi"; then
            CURRENT_IMAGE=$(docker inspect japi --format='{{.Config.Image}}')
            echo "Container: japi"
            echo "Image: $CURRENT_IMAGE"
            docker ps | grep "japi" | awk '{print "Status:", $7, $8, $9}'
          else
            echo "âš ï¸  No container is currently running"
          fi
          
          echo ""
          echo "ğŸ’¾ Total images: $(docker images jeeroway-api | tail -n +2 | wc -l)"

  cleanup:
    needs: list-versions
    uses: ./.github/workflows/shared/cleanup-old-images.yml
    with:
      image_name: jeeroway-api
      keep_versions: 5
      container_name: japi
